{% extends 'base.html' %}

{% block title %}Statistics{% endblock %}

{% block content %}
<div class="container mt-5">
    <h1 class="mb-4">Statistics</h1>

    <div class="row">
        <div class="col-md-6">
            <div class="card text-white bg-primary mb-3">
                <div class="card-header">Reparations Per Month</div>
                <div class="card-body">
                    <h5 class="card-title">{{ reparation_per_month|length }}</h5>
                    <p class="card-text">Number of reparations this month.</p>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card text-white bg-success mb-3">
                <div class="card-header">Reparations Per Year</div>
                <div class="card-body">
                    <h5 class="card-title">{{ reparation_per_year|length }}</h5>
                    <p class="card-text">Number of reparations this year.</p>
                </div>
            </div>
        </div>
    </div>

    <h2 class="my-4">Materials by Fournisseur</h2>
    <div class="row">
        {% for fournisseur in fournisseurs %}
        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-header">{{ fournisseur.fournisseur_name }}</div>
                <div class="card-body">
                    <canvas id="fournisseurChart{{ fournisseur.fournisseur_id }}"></canvas>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    {% for fournisseur in fournisseurs %}
    var ctxFournisseur{{ fournisseur.fournisseur_id }} = document.getElementById('fournisseurChart{{ fournisseur.fournisseur_id }}').getContext('2d');
    var fournisseurChart{{ fournisseur.fournisseur_id }} = new Chart(ctxFournisseur{{ fournisseur.fournisseur_id }}, {
        type: 'bar',
        data: {
            labels: [
                {% for material in fournisseur_materials[fournisseur.fournisseur_id] %}
                    '{{ material.code_a_barre }}',
                {% endfor %}
            ],
            datasets: [{
                label: 'Materials',
                data: [
                    {% for material in fournisseur_materials[fournisseur.fournisseur_id] %}
                        {{ material.material_id }},
                    {% endfor %}
                ],
                backgroundColor: 'rgba(153, 102, 255, 0.2)',
                borderColor: 'rgba(153, 102, 255, 1)',
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
    {% endfor %}
</script>
{% endblock %}
